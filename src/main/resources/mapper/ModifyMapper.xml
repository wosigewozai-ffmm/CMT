<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.seu.CMT.mapper.ModifyMapper">

    <!-- 自定义结果集-->
    <resultMap id="relationMap" type="com.seu.CMT.pojo.Relation">
        <result property="nameA" column="nameA"/>
        <result property="relation" column="relation"/>
        <result property="nameB" column="nameB"/>
        <collection property="resultRelations" ofType="com.seu.CMT.pojo.Relation">
            <result property="nameA" column="nameA1"/>
            <result property="relation" column="relation1"/>
            <result property="nameB" column="nameB"/>
        </collection>
    </resultMap>

    <resultMap id="resultMap" type="com.seu.CMT.pojo.Model">
        <id property="id" column="id"/>
        <result property="name" column="name"/>
        <result property="type" column="type"/>
        <collection property="resultModels" ofType="com.seu.CMT.pojo.Model">
            <id property="id" column="id1"/>
            <result property="name" column="name1"/>
            <result property="type" column="type1"/>
        </collection>
    </resultMap>

    <select id="getAll" resultMap="resultMap">
        match
        (u:Model)
        where u.type = #{type}
        return
        id(u) as id,u.name as name,u.type as type
    </select>

    <select id="find" resultMap="resultMap">
        match
        (u:Model)
        where u.name = #{name}
        return
        u.name as name, u.type as type
    </select>

    <select id="findRelation" resultMap="resultMap">
        MATCH (m:Model { name:#{relation.nameA}})
        MATCH (n:Model { name:#{relation.nameB}})
        MATCH (m)-[:${relation.relation}]->(n)
        return n,m
    </select>

    <!--create(u:user{name:'aaa'}) - [l:like] -> (u1:user{name:'bbb'}) - [l1:like] -> (u2:user{name:'ccc'})-->
    <insert id="add">
        create(u:Model{name:#{model.name},type:#{model.type},effect:#{model.effect},prescription:#{model.prescription},herb:#{model.herb},symptom:#{model.symptom},function_large:#{model.function_large},function_small:#{model.function_small}})
    </insert>

    <insert id="addRelation">
        match (n:Model{name:#{relation.nameA}}) , (m:Model{name:#{relation.nameB}} )
        create  (n) - [${relation.relation}:${relation.relation}{name:"${relation.relation}"}] -> (m)
    </insert>

    <delete id="deleteEntity">
        MATCH (n:Model{name:#{model.name}}) DETACH DELETE n
    </delete>
    <delete id="deleteRelation">
        match p=(x)-[r]->(y) where x.name=#{relation.nameA} and y.name=#{relation.nameB} and r.name="${relation.relation}"
        delete r
    </delete>

    <select id="findEntityRelation" resultMap="relationMap">
        match p=(x)-[r]->(y) where x.name="${model.name}" or y.name="${model.name}"
        return x.name as nameA, r.name as relation, y.name as nameB
    </select>

    <update id="updateEntity">
        match (u:Model)
        where u.name = #{model.name}
        set u.name = #{model.name},u.type = #{model.type}
    </update>

</mapper>